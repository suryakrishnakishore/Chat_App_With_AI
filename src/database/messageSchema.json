{
    "$jsonSchema": {
        "bsonType": "object",
        "required": [
            "chatId",
            "senderId",
            "messageType",
            "timestamp"
        ],
        "properties": {
            "chatId": {
                "bsonType": "objectId",
                "description": "ObjectId of the chat this message belongs to."
            },
            "senderId": {
                "bsonType": "objectId",
                "description": "User ObjectId of the sender."
            },
            "receiverId": {
                "bsonType": [
                    "objectId",
                    "null"
                ],
                "description": "User ObjectId of the receiver for private chat, null in group."
            },
            "messageType": {
                "enum": [
                    "text",
                    "image",
                    "video",
                    "audio",
                    "file",
                    "location"
                ],
                "description": "Defines type of the message."
            },
            "attachments": {
                "bsonType": [
                    "array",
                    "null"
                ],
                "items": {
                    "bsonType": "object",
                    "required": [
                        "url",
                        "mimeType"
                    ],
                    "properties": {
                        "url": {
                            "bsonType": "string"
                        },
                        "mimeType": {
                            "bsonType": "string"
                        },
                        "size": {
                            "bsonType": [
                                "int",
                                "long",
                                "null"
                            ]
                        },
                        "thumbnail": {
                            "bsonType": [
                                "string",
                                "null"
                            ]
                        },
                        "duration": {
                            "bsonType": [
                                "int",
                                "null"
                            ]
                        }
                    }
                },
                "description": "Array of media attachments with metadata."
            },
            "location": {
                "bsonType": [
                    "object",
                    "null"
                ],
                "properties": {
                    "lat": {
                        "bsonType": "double"
                    },
                    "lng": {
                        "bsonType": "double"
                    },
                    "name": {
                        "bsonType": "string"
                    }
                },
                "description": "Location message metadata."
            },
            "replyTo": {
                "bsonType": [
                    "objectId",
                    "null"
                ],
                "description": "ObjectId of the message being replied to."
            },
            "forwarded": {
                "bsonType": "bool",
                "description": "Whether the message was forwarded."
            },
            "timestamp": {
                "bsonType": "date",
                "description": "Message timestamp."
            },
            "deliveredTo": {
                "bsonType": [
                    "array",
                    "null"
                ],
                "items": {
                    "bsonType": "objectId"
                },
                "description": "Array of users who received the message."
            },
            "readBy": {
                "bsonType": [
                    "array",
                    "null"
                ],
                "items": {
                    "bsonType": "objectId"
                },
                "description": "Array of users who have read the message."
            },
            "status": {
                "enum": [
                    "sent",
                    "delivered",
                    "read",
                    "deleted"
                ],
                "description": "Current delivery state of the message."
            }
        }
    }
}